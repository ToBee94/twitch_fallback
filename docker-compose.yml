version: '3.8'

services:
  # NGINX RTMP Server for seamless streaming
  rtmp:
    image: tiangolo/nginx-rtmp:latest
    container_name: twitch_rtmp_server
    ports:
      - "1935:1935"  # RTMP port
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    restart: unless-stopped
    networks:
      - twitch_network

  # Twitch Stream Manager Application
  stream_manager:
    build: .
    container_name: twitch_stream_manager
    ports:
      - "5000:5000"  # Web UI port
    volumes:
      - ./config.yml:/app/config.yml
      - ./media:/app/media
      - ./users.yml:/app/users.yml
    environment:
      - PYTHONUNBUFFERED=1
    depends_on:
      - rtmp
    restart: unless-stopped
    networks:
      - twitch_network

networks:
  twitch_network:
    driver: bridge
